---
title: Virtual DOM, 최대한 쉬운 언어로
date: 2022.08.29
author: hulk
slogan: 즐겁게 코딩하고 항상 성장하고 싶은 개발자입니다.
tags: "#react #DOM #VirtualDOM"
category: tech
content: 간단하게는 실제 DOM의 복사본 정도라고 말할 수 있을 것 같습니다. Virtual DOM은 실제 DOM 노드를 복사해 그것을 자바스크립트 객체로 관리합니다. 실제 DOM이 렌더링 되면 그 DOM 트리를 복사합니다..
thumbnail: https://cdn.discordapp.com/attachments/1002228584401870871/1014523289642729543/Virtual_DOM.png
---

> Virtual DOM (VDOM)은 UI의 이상적인 또는 “가상”적인 표현을 메모리에 저장하고 ReactDOM과 같은 라이브러리에 의해 “실제” DOM과 동기화하는 프로그래밍 개념입니다. 이 과정을 재조정이라고 합니다.

리액트 공식 문서에 있는 Virtual-Dom의 정의입니다. 이 인용 글에서 알 수 있듯이 Virtual DOM은 general한 개념입니다. <br />
오늘은 리액트에서의 Virtual DOM에 초점을 맞추어 차근차근 정리해 보려 합니다.
앞서 인용 글에 있던 문구가 다소 추상적인 느낌입니다.<br /> 가상적인 표현을 메모리에 저장하는 것은 무엇이며 실제 DOM과 동기화를 어떻게 하며, 재조정은 무엇일까요?

## 브라우저 렌더링 과정

Virtual-DOM을 살펴보기에 앞서 브라우저 렌더링 과정을 한 번 상기시켜볼 필요가 있을 것 같습니다.

![browser-rendering](https://cdn.discordapp.com/attachments/996456164634144848/996456327205376050/2022-07-13_1.41.35.png)

1. 브라우저가 HTML을 받아서 한 줄 한 줄 읽습니다.
2. HTML의 요소들을 브라우저가 제어할 수 있는 DOM으로 변환합니다.
3. CSS 파일과 인라인 스타일들을 파싱 해서 CSSOM을 만듭니다. 그리고 DOM + CSSOM = 렌더 트리를 생성하죠
4. 그다음 Reflow라고도 불리는 Layout 과정이 이루어집니다. 이 과정에서는 각 노드들이 어디에 얼마나 크게 배치되어야 할지 등에 대한 것들을 계산하죠.
5. 계산된 레이아웃을 기반으로 레이어를 형성하는 단계인 Paint 과정을 거칩니다.
6. 마지막으로 페인트 과정에서 준비된 레이어들을 실제로 화면에 표기하는 Composition이 이루어지고 우리가 비로소 화면에서 볼 수 있게 됩니다.

(브라우저 렌더링의 자세한 내용은 이전 제 포스팅을 참고해 주세요)
[태로 블로그 : 브라우저 렌더링 순서](https://taero.blog/posts/browser-rendering)

## 만약 DOM에 변화가 발생했다면?

사용자의 어떤 인터렉션에 의해서 위 과정을 거친 DOM에 변화가 발생한다면 위 3번 과정인 렌더 트리를 재생성하고 그 이후에 Reflow, Paint, Composition도 당연히 다시 반복됩니다.

단순히 정보만 전달하는 (제 블로그 같은) 정적인 사이트에서는 이런 것이 사실 크게 문제가 되지 않을 수도 있습니다. 하지만 인터렉션이 아주 많이 발생하는 경우에는 웹의 성능 저하가 일어날 수 있습니다.

이러한 배경 때문에 DOM을 조금 더 효율적으로 조작할 수 있게끔 최적화가 필요해졌습니다.
그 수단이 바로 Virtual-DOM입니다.

## Virtual DOM

간단하게는 실제 DOM의 복사본 정도라고 말할 수 있을 것 같습니다.<br />Virtual DOM은 실제 DOM 노드를 복사해 그것을 자바스크립트 객체로 관리합니다.

### 동작

![virtual-dom](https://cdn.discordapp.com/attachments/1002228584401870871/1014521771921244212/img_1.png)

1. 실제 DOM이 렌더링 되면 그 DOM 트리를 복사합니다.
2. 그리고 만약 인터렉션 등이 일어나 DOM 요소에 변화가 생기면 Virtual DOM은 다시 새로운 복사본을 처음부터 다시 만듭니다.
3. 그리고 이전의 복사본과 새로운 복사본을 비교하는데, 이때 변경된 부분만을 감지합니다.
   (여기서 중요한 부분은 위 과정이 실제 화면에 렌더링 되는 결과로 이어지는 것이 아니라, 메모리 상에서만 이루어진다는 것입니다.)

React는 이 두 개의 복사본을 비교하는 것에 Diffing Algorithm(비교 알고리즘)을 사용한다고 소개하고 있습니다. <br /> 공식 문서를 보면 이 Diffing 알고리즘은 어떤 요소의 속성값만 변화가 되었다면 속성값만 업데이트를 하고,<br /> key라는 속성을 이용해 자식 요소들을 관리하는 등 새로운 복사본을 생성하고 기존의 복사본과 비교하는 작업 등이 효율적으로 이루어질 수 있도록 최적화되었다는 것을 확인하실 수 있습니다.<br />알고리즘과 관련된 자세한 내용들은 다음 기회에 포스팅 해보도록 하겠습니다.

여기서는 복잡하게 생각하지 말고 일단 새로운 복사본을 생성하는 것과 복사본끼리의 비교가 엄청 빠르구나 정도로 생각하면 좋을 것 같습니다.
[React 공식 문서](https://ko.reactjs.org/docs/reconciliation.html)

4. 그다음으로는 변경된 부분들을 실제 DOM에 적용합니다. 중요한 점은 변경된 부분만 실제 DOM에 전달된다는 점입니다.

이렇게 브라우저 렌더링 (reflow-layout-painting-composition) 등의 과정 없이 변경된 것들을 전부 Virtual DOM(새 복사본)에 반영한 뒤에 변경된 부분들만 모아서 실제 DOM에 전달합니다.<br /> 그렇기 때문에 실제 DOM에서는 변경된 것들을 통째로 받아 한 번만 렌더링 하도록 하게 되는 것입니다.

핵심적인 부분은 VIrtual DOM은 기존의 Virtual DOM 스냅샷과 비교해 <strong>'변경된 부분만'</strong>을 감지<br />또한 그 모든 변경사항들을 <strong>'하나로 묶어'</strong> 리렌더링을 딱 한 번만 시킨다는 것입니다.

### 재조정

이러한 일련의 과정들을 React에서는 재조정이라고 합니다.<br /> 글 도입부에서 봤던 React 공식 문서의 글을 다시 한번 보겠습니다.

> Virtual DOM (VDOM)은 UI의 이상적인 또는 “가상”적인 표현을 메모리에 저장하고 ReactDOM과 같은 라이브러리에 의해 “실제” DOM과 동기화하는 프로그래밍 개념입니다. 이 과정을 재조정이라고 합니다.

결국 Virtual DOM은 UI에 대한 상태를 메모리에 객체로 관리하고, 그 객체의 복사본끼리 비교하고, 비교가 끝난 뒤에는 차이점만 묶어서 `ReactDOM.render()`를 통해 실제 DOM에 표현되도록 하는 것입니다,

다음 기회에는 React와 ReactDOM API를 조금만 더 자세히 살펴보며 diffing 알고리즘이 어떻게 이루어지는지 다뤄보도록 하겠습니다.
